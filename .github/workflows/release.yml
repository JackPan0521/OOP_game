name: Build and Release JAR

on:
  push:
    tags:
      - 'v*'

jobs:
  build-release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Java 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
    
    - name: Create bin directory
      run: mkdir -p bin
    
    - name: Compile game code
      run: javac -d bin src/characters/*.java src/battle/*.java src/events/*.java src/game/*.java
    
    - name: Build JAR file
      run: |
        cd bin
        jar cvfm ../OOP_game.jar ../META-INF/MANIFEST.MF characters/ battle/ events/ game/
        cd ..
    
    - name: Verify JAR file
      run: |
        echo "âœ… JAR file created successfully!"
        ls -lh OOP_game.jar
        echo ""
        echo "ğŸ“¦ JAR contents:"
        jar tf OOP_game.jar | head -20
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: OOP_game.jar
        body: |
          ğŸ® OOP Medieval War Game - Release
          
          ## ğŸ“¥ How to Play
          
          ### Requirements
          - Java 11 or higher installed
          
          ### Quick Start
          ```bash
          java -jar OOP_game.jar
          ```
          
          ### Features
          - âš”ï¸ Turn-based battle system
          - ğŸ¯ Multiple enemy types (Soldiers, Generals, Deserters)
          - ğŸ¤ NPC interactions (Mercenary, Wandering Monk)
          - ğŸª Random events (Battlefield ruins, Surrendered enemies, Church trial)
          - ğŸ† 4 different endings based on your choices
          
          ### Game Stats
          - Honor (æ¦®è­½)
          - War Points (æˆ°åŠŸ)
          - Kill Count (æ“Šæ®ºæ•¸)
          
          ### Endings
          1. âœ¨ Honorable Knight (æ¦®è­½é¨å£«)
          2. âš”ï¸ War Survivor (æˆ°çˆ­å€–å­˜è€…)
          3. ğŸ©¸ Bloodthirsty Butcher (å—œè¡€å± å¤«)
          4. â˜ ï¸ Fallen on Battlefield (æˆ°æ­»æ²™å ´)
          
          Enjoy the game! ğŸ—¡ï¸
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Release Summary
      run: |
        echo "ğŸ‰ Release Complete!"
        echo "===================="
        echo "âœ… JAR file built successfully"
        echo "ğŸ“¦ File: OOP_game.jar"
        echo "ğŸ”— GitHub Release URL:"
        echo "   https://github.com/${{ github.repository }}/releases/tag/${{ github.ref_name }}"
        echo ""
        echo "ğŸ“¥ Users can download and run:"
        echo "   java -jar OOP_game.jar"
